<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard | SQL Secure Cloud</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 40px;
      }
      .alert {
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 5px;
      }
      .alert-success { background-color: #d4edda; color: #155724; }
      .alert-warning { background-color: #fff3cd; color: #856404; }
      .alert-danger  { background-color: #f8d7da; color: #721c24; }
    </style>
  </head>
  <body>
    <h2>Welcome, {{ user.username }}!</h2>
    <p>Your email: {{ user.email }}</p>
    <p>This is your secure dashboard.</p>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Note count -->
    <p>You have {{ note_count }} secure notes.</p>

    <!-- Secure note list -->
    <h3>Your Secure Notes:</h3>
    <ul>
      {% for note in notes %}
        <li>{{ note }}</li>
      {% endfor %}
    </ul>

    <!-- Add note form -->
    <h3>Add a New Secure Note:</h3>
    <form method="POST" action="{{ url_for('main.add_note') }}">
      <textarea name="note" placeholder="Enter your secure note..." rows="4" cols="50" required></textarea><br>
      <button type="submit">Add Secure Note</button>
    </form>

    <!-- Encrypted file list -->
    <h3>Your Encrypted Files:</h3>
    <ul>
      {% for file in files %}
        <li>
          {{ file.filename }} ‚Äî {{ file.timestamp.strftime('%Y-%m-%d %H:%M') }}
          [<a href="{{ url_for('main.download', file_id=file.id) }}">Download</a>]
        </li>
      {% else %}
        <li>No files uploaded yet.</li>
      {% endfor %}
    </ul>

    <!-- Upload link -->
    <p><a href="{{ url_for('main.upload') }}">Upload a new encrypted file</a></p>

    <!-- Recent audit logs -->
    <h3>Recent Activity:</h3>
    <ul>
      {% for log in logs %}
        <li>{{ log.timestamp.strftime('%Y-%m-%d %H:%M') }} ‚Äî {{ log.action }}</li>
      {% else %}
        <li>No recent activity logged.</li>
      {% endfor %}
    </ul>

    <!-- Logout -->
    <form action="{{ url_for('main.logout') }}" method="get" style="margin-top: 20px;">
      <button type="submit">Logout</button>
    </form>

    <footer style="margin-top: 40px;">
      <p>üîê SQL Secure Cloud ‚Äî Built by Raza</p>
    </footer>
  </body>
</html>